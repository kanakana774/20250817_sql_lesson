# 実務研修課題：EC サイトのデータ分析

テーブル構成
customers_mst (顧客マスタ)
customer_id (主キー)
customer_name
email
created_date

products_mst (商品マスタ)
product_id (主キー)
product_name
price
stock_quantity

orders_trn (注文トランザクション)
order_id (主キー)
customer_id (外部キー → customers_mst)
order_date

order_details_trn (注文明細トランザクション)
order_detail_id (主キー)
order_id (外部キー → orders_trn)
product_id (外部キー → products_mst)
quantity (購入個数)

## 第 1 週：基礎編

課題 1：新商品情報の登録
新規に発売する商品の情報を**products**テーブルに登録してください。

商品 ID：P101
商品名：ワイヤレスイヤホン
価格：12800
在庫数：500

課題 2：在庫数が少ない商品の特定
在庫数が 50 個以下の商品を抽出し、価格が高い順に表示してください。

課題 3：顧客ごとの注文数集計
各顧客がこれまでに注文した総件数と合計購入金額を、顧客 ID ごとに集計してください。

## 第 2 週：応用編（テーブル結合とサブクエリ）

課題 4：注文ごとの詳細レポート
各注文について、以下の情報を 1 つのレポートとして表示してください。

注文 ID
注文日
購入した顧客の氏名
注文された商品の商品名
商品の価格

課題 5：購入履歴のない顧客の特定
これまでに一度も注文したことのない顧客の氏名を抽出してください。

課題 6：特定期間の売上ランキング
過去 1 ヶ月間（例えば、2024-07-01 から 2024-07-31）の間に、最も多く売れた商品トップ 3 の商品名と販売個数を表示してください。

## 第 3 週：応用編の深化（ウィンドウ関数とトランザクション）

課題 7：前日の売上との比較
日ごとの売上合計を算出し、前日との売上差額も同時に表示するレポートを作成してください。

課題 8：データ更新のシミュレーション
キャンペーンのため、商品 ID が P005 の商品の価格を一時的に 1000 円に引き下げてください。
ただし、万が一の事態に備え、この操作をトランザクションとして実行し、最終的に**ROLLBACK**で元の価格に戻してください。

## 第 4 週：パフォーマンス・運用編

課題 9：パフォーマンス改善（実行計画の解析）
以下の SQL 文を実行し、その実行計画を確認してください。もし非効率な点があれば、それを指摘し、より効率的な SQL 文に書き換えてください。

SQL

```SQL
SELECT C.customer_name, P.product_name, O.order_date
FROM orders O, customers C, products P
WHERE O.customer_id = C.customer_id AND OD.product_id = P.product_id
AND O.order_date BETWEEN '2024-01-01' AND '2024-12-31'
AND C.customer_name LIKE '山田%';
```

課題 10：SQL インジェクション対策
ユーザーが入力した商品名で商品を検索する Web アプリケーションを開発しています。以下の SQL 文にはセキュリティ上の脆弱性があります。この脆弱性が何であるかを説明し、安全な SQL 文に書き換えてください。

SQL

```SQL
SELECT \* FROM products WHERE product_name = '"+ userInput +"'
新しい課題は、より一般的な EC サイトのビジネスロジックに即しているかと思います。この内容であれば、より実践的な研修として役立つでしょう。
```
